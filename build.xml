<project name="JTL-Connector-WooCommerce-Endpoint" default="clean">

    <target name="build" depends="clean">
        <mkdir dir="./dist/jtlconnector/includes/"/>
        <mkdir dir="./dist/jtlconnector/config"/>
        <mkdir dir="./dist/jtlconnector/db"/>
        <mkdir dir="./dist/jtlconnector/languages"/>
        <mkdir dir="./dist/jtlconnector/logs"/>
        <mkdir dir="./dist/jtlconnector/plugins"/>
        <mkdir dir="./dist/jtlconnector/tmp"/>

        <copy todir="./dist/jtlconnector/config">
            <fileset dir="./config">
                <include name="features.json"/>
                <include name=".htaccess"/>
            </fileset>
        </copy>
        <!--<touch file="./dist/jtlconnector/config/config.json"/>-->
        <echo file="./dist/jtlconnector/config/config.json" append="false">{"developer_logging": false}</echo>
        <copy todir="./dist/jtlconnector/db">
            <fileset dir="./db">
                <include name=".htaccess"/>
            </fileset>
        </copy>
        <copy todir="./dist/jtlconnector/languages">
            <fileset dir="./languages">
                <include name="**.mo"/>
            </fileset>
        </copy>
        <copy todir="./dist/jtlconnector/logs">
            <fileset dir="./logs">
                <include name=".htaccess"/>
            </fileset>
        </copy>
        <copy todir="./dist/jtlconnector/">
            <fileset dir="./">
                <include name="index.php"/>
                <include name="jtlconnector.php"/>
                <include name="uninstall.php"/>
                <include name="LICENSE"/>
                <include name="CHANGELOG.md"/>
            </fileset>
        </copy>
        <copy todir="./dist/jtlconnector/includes">
            <fileset dir="./includes">
                <include name="**.php"/>
            </fileset>
        </copy>

        <copy todir="./build/">
            <fileset dir="./">
                <include name="src/"/>
                <include name="vendor/"/>
            </fileset>
        </copy>
    </target>

    <target name="package" depends="build">
        <loadfile property="version" file="version"/>
        <pharpackage
                destfile="./dist/jtlconnector/connector.phar"
                basedir="./build"
                compression="gzip"
                stub="./stub.php"
                signature="sha256">
            <fileset dir="./build">
                <include name="**/**"/>
            </fileset>
            <metadata>
                <element name="copyright" value="2010-2013 JTL-Software GmbH"/>
                <element name="version" value="${version}"/>
                <element name="authors">
                    <element name="Sven MÃ¤urer">
                        <element name="email" value="sven.maeurer@jtl-software.com"/>
                    </element>
                </element>
            </metadata>
        </pharpackage>
    </target>

    <target name="release" depends="package">
        <zip destfile="./jtl-connector-woocommerce-${version}.zip" basedir="./dist"/>
        <phingcall target="clean"/>
    </target>

    <target name="clean">
        <delete dir="./build" quiet="true"/>
        <delete dir="./dist" quiet="true"/>
    </target>
</project>